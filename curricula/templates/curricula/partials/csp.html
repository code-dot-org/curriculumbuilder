

{% load mezzanine_tags %}
<div class="together" id="lesson{{ lesson.number }}">
    {% editable lesson.title %}
        <h1>Lesson {{ lesson.number }}: {{ lesson.title }}</h1>
    {% endeditable %}
</div>

<div class="together overview-page row">

    <div class="col-sm-8 left-col">

        <h2>Overview</h2>
        {% editable lesson.overview %}
            {{ lesson.overview|richtext_filters|safe }}
        {% endeditable %}

        <h2>Lesson Summary</h2>
        <div class="toc" id="toc{{ lesson|slugify }}">
            {% for activity in lesson.activity_set.all %}
                <h3>{{ activity.name }}</h3>
            {% endfor %}
        </div>

        {% if lesson.cs_content %}
            <h2>CS Content</h2>
            {% editable lesson.cs_content %}
                {{ lesson.cs_content|richtext_filters|safe }}
            {% endeditable %}
        {% endif %}

    </div>

    <div class="col-sm-4 right-col">

        {% if lesson.anchor_standards.all.count > 0 %}
            <h2>Anchor Standard{% if lesson.anchor_standards.all.count > 1 %}s{% endif %}</h2>
            {% with lesson.anchor_standards.all as standards %}
                {% regroup standards by framework as standards_by_framework %}
                {% for framework in standards_by_framework %}
                    <h3>{{ framework.grouper }}</h3>
                    <ul>
                        {% for standard in framework.list %}
                            <li><strong>{{ standard.shortcode }}</strong> - {{ standard.description }}</li>
                        {% endfor %}
                    </ul>
                {% endfor %}
            {% endwith %}
        {% endif %}

        {% if lesson.objective_set.count > 0 %}
            <h2>Objectives</h2>
            <h3>Students will be able to:</h3>
            <ul>
                {% for objective in lesson.objective_set.all %}
                    <li>{{ objective.description }}</li>
                {% endfor %}
            </ul>
        {% endif %}

        {% if lesson.prep %}
            <h2>Materials and Prep</h2>
            {% editable lesson.prep %}
                {{ lesson.prep|richtext_filters|safe }}
            {% endeditable %}
        {% endif %}

        {% if lesson.resources.count > 0 %}
            <h2>Resources</h2>
            {% with lesson.resources.all as resources %}
                {% regroup resources by student as resources_by_audience %}
                {% for audience in resources_by_audience %}
                    <h3>For the {{ audience.grouper|yesno:"Students,Teacher" }}</h3>
                    <ul>
                        {% for resource in audience.list %}
                            <li>
                                {{ resource|safe }}
                            </li>
                        {% endfor %}
                    </ul>
                {% endfor %}
            {% endwith %}
        {% endif %}

        {% if lesson.vocab.count > 0 %}
            <h2>Vocabulary</h2>
            <ul>
                {% for word in lesson.vocab.all %}
                    <li><strong>{{ word.word }}</strong> - {{ word.detailDef }}</li>
                {% endfor %}
            </ul>
        {% endif %}

    </div>
</div>

<div id="lesson_content">

    <h1>Teaching Guide</h1>

    {% for activity in lesson.activity_set.all %}
        <div class="activity">
            {% editable activity.name activity.content %}
                <h2>{{ activity.name }}</h2>
                {{ activity.content|richtext_filters|safe }}
            {% endeditable %}
        </div>
    {% endfor %}
</div>

<div id="standards">
    <h2>Standards Alignment</h2>
    {% with lesson.standards.all as standards %}
        {% regroup standards by framework as standards_by_framework %}
        {% for framework in standards_by_framework %}
            <details class="framework">
                <summary>{{ framework.grouper }}</summary>
                <!--<ul>-->
                {% for standard in framework.list %}
                    <details class="standard">
                        <summary>{{ standard.shortcode }}</summary>
                        <p>{{ standard.description }}</p>
                    </details>
                {% endfor %}
                <!--</ul>-->
            </details>
        {% endfor %}
    {% endwith %}
</div>
<script type="text/javascript">
    $('#toc{{ lesson.title|slugify }}').toc({
        'selectors': 'h2,h3', //elements to use as headings
        'container': '#lesson_content', //element to find all selectors in
        'smoothScrolling': false, //enable or disable smooth scrolling on click
        'prefix': '{{ lesson.title|slugify }}', //prefix for anchor tags and class names
        'onHighlight': function (el) {
        }, //called when a new section is highlighted
        'highlightOnScroll': true, //add class to heading that is currently in focus
        'highlightOffset': 100, //offset to trigger the next headline
        'anchorName': function (i, heading, prefix) { //custom function for anchor name
            return prefix + i;
        },
        'headerText': function (i, heading, $heading) { //custom function building the header-item text
            return $heading.text();
        },
        'itemClass': function (i, heading, $heading, prefix) { // custom function for item class
            return $heading[0].tagName.toLowerCase();
        }
    });
</script>