{% load i18n %}
{% load field_type %}

{# Edit form #}
<form style="display:none;" class="editable-form" method="post"
    action="{% url "edit" %}" id="{{ editable_form.uuid }}"
    {% if editable_form.is_multipart %} enctype="multipart/form-data"{% endif %}>
    {% csrf_token %}
    {% for field in editable_form %}
    <div{% if field.is_hidden %} style="display:none;"{% endif %}>
        {{ field.label_tag }}
        <br />{{ field }}{{ field.errors }}

        {# The django-codemirror-widget plugin makes assuptions about the field id #}
        {# Those assumptions are untrue in the inline editor, so we load manually #}
        {% if field|field_type == 'CodeMirrorTextarea' %}
            <script type="text/javascript">
                var thisScript = $('script').last();
                var uuid = $(thisScript).closest('form').attr('id');
                var editor = CodeMirror.fromTextArea(document.getElementById("{{ field.name }}-{{ editable_form.uuid }}"),
                        {
                            theme: "default",
                            mode: "markdown",
                            lineWrapping: true,
                            lineNumbers: false,
                            autoRefresh: true,
                            autoCloseBrackets: true,
                            matchBrackets: true,
                            extraKeys: {"Enter": "newlineAndIndentContinueMarkdownList"}

                        });
                setTimeout(editor.refresh(),0); // Otherwise filed is blank until clicked
            </script>
        {% endif %}
        {% if field.help_text %}
        <span class="helptext">{{ field.help_text }}</span>
        {% endif %}
    </div>
    {% endfor %}
    <input type="submit" value="{% trans "Save" %}" class="btn btn-primary btn-lg">
    <input type="button" value="{% trans "Cancel" %}" class="btn btn-default btn-lg">
</form>

{# Original content wrapped in span #}
<div class="editable-original">{{ original }}</div>

{# Edit link #}
<a style="visibility:hidden;" class="editable-link" href="#"
    rel="#{{ editable_form.uuid }}">{% trans "Edit" %}</a>

{# Edit highlight #}
<div style="visibility:hidden;" class="editable-highlight"></div>
